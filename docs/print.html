<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Warpgrapher Book (0.3.0)</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="warpgrapher/intro.html"><strong aria-hidden="true">1.</strong> Warpgrapher</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="warpgrapher/quickstart.html"><strong aria-hidden="true">1.1.</strong> Quickstart</a></li><li class="chapter-item expanded "><a href="warpgrapher/databases.html"><strong aria-hidden="true">1.2.</strong> Databases</a></li><li class="chapter-item expanded "><a href="warpgrapher/config.html"><strong aria-hidden="true">1.3.</strong> Config</a></li></ol></li><li class="chapter-item expanded "><a href="api/intro.html"><strong aria-hidden="true">2.</strong> CRUD API</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/node_read.html"><strong aria-hidden="true">2.1.</strong> Node Read</a></li><li class="chapter-item expanded "><a href="api/node_create.html"><strong aria-hidden="true">2.2.</strong> Node Create</a></li><li class="chapter-item expanded "><a href="api/node_update.html"><strong aria-hidden="true">2.3.</strong> Node Update</a></li><li class="chapter-item expanded "><a href="api/node_delete.html"><strong aria-hidden="true">2.4.</strong> Node Update</a></li><li class="chapter-item expanded "><a href="api/rel_read.html"><strong aria-hidden="true">2.5.</strong> Relationship Read</a></li><li class="chapter-item expanded "><a href="api/rel_create.html"><strong aria-hidden="true">2.6.</strong> Relationship Create</a></li><li class="chapter-item expanded "><a href="api/rel_update.html"><strong aria-hidden="true">2.7.</strong> Relationship Update</a></li><li class="chapter-item expanded "><a href="api/rel_delete.html"><strong aria-hidden="true">2.8.</strong> Relationship Delete</a></li></ol></li><li class="chapter-item expanded "><a href="engine/intro.html"><strong aria-hidden="true">3.</strong> Engine Features</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="engine/endpoints_static.html"><strong aria-hidden="true">3.1.</strong> Static Endpoints</a></li><li class="chapter-item expanded "><a href="engine/endpoints_defined.html"><strong aria-hidden="true">3.2.</strong> Defined Endpoints</a></li><li class="chapter-item expanded "><a href="engine/dynamic_props.html"><strong aria-hidden="true">3.3.</strong> Dynamic Props</a></li><li class="chapter-item expanded "><a href="engine/dynamic_rels.html"><strong aria-hidden="true">3.4.</strong> Dynamic Relationships</a></li><li class="chapter-item expanded "><a href="engine/context_global.html"><strong aria-hidden="true">3.5.</strong> Global Context</a></li><li class="chapter-item expanded "><a href="engine/context_request.html"><strong aria-hidden="true">3.6.</strong> Request Context</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Warpgrapher Book (0.3.0)</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#warpgrapher" id="warpgrapher">Warpgrapher</a></h1>
<p>Warpgrapher is framework for developing graph-based API services. Describe the 
data model for which you want to run a web service. Wargrapher automatically 
generates a GraphQL schema from the data model, as well as a set of resolvers 
for basic reate, read, update, and delete (CRUD) operations on that data.</p>
<p>If you need more more sophisticated, custom queries and endpoints, you can
supply your own custom resolvers. Warpgrapher will automatically generate the
GraphQL configuration and invoke your custom resolvers when appropriate.</p>
<p>The project is currently in development. Prior to reaching v1.0.0:</p>
<ol>
<li>Minor versions represent breaking changes.</li>
<li>Patch versions represent fixes and features.</li>
<li>There are no deprecation warnings between releases.</li>
</ol>
<h1><a class="header" href="#quickstart" id="quickstart">Quickstart</a></h1>
<p>This guide will walk you through creating a brand new project using the Warpgrapher engine served over HTTP using actix-web. The back-end graph database in this example is Neo4J. </p>
<h2><a class="header" href="#source" id="source">Source</a></h2>
<p><code>cargo.toml</code></p>
<pre><code class="language-toml">[dependencies]
warpgrapher = { version = &quot;0.3.0&quot;, features = [&quot;neo4j&quot;] }
</code></pre>
<p><code>src/main.rs</code></p>
<pre><code class="language-rust no_run noplayground">use std::collections::HashMap;
use std::convert::TryFrom;
use tokio::runtime::Runtime;
use warpgrapher::engine::config::Configuration;
use warpgrapher::engine::database::neo4j::Neo4jEndpoint;
use warpgrapher::engine::database::DatabaseEndpoint;
use warpgrapher::juniper::http::GraphQLRequest;
use warpgrapher::Engine;

static CONFIG: &amp;str = &quot;
version: 1
model:
  - name: User
    props:
      - name: email
        type: String
&quot;;

fn main() {
    // parse warpgrapher config
    let config = Configuration::try_from(CONFIG.to_string()).expect(&quot;Failed to parse CONFIG&quot;);

    // define database endpoint
    let db = Runtime::new()
        .expect(&quot;Expected tokio runtime.&quot;)
        .block_on(
            Neo4jEndpoint::from_env()
                .expect(&quot;Failed to parse neo4j endpoint from environment&quot;)
                .pool(),
        )
        .expect(&quot;Failed to create neo4j database pool&quot;);

    // create warpgrapher engine
    let engine: Engine&lt;(), ()&gt; = Engine::new(config, db)
        .build()
        .expect(&quot;Failed to build engine&quot;);

    // execute graphql mutation to create new user
    let request = GraphQLRequest::new(
        &quot;mutation {
            UserCreate(input: {
                email: \&quot;a@b.com\&quot;
            }) {
                id
                email
            }
        }
        &quot;
        .to_string(),
        None,
        None,
    );
    let metadata = HashMap::new();
    let result = engine.execute(&amp;request, &amp;metadata).unwrap();

    // display result
    println!(&quot;result: {:#?}&quot;, result);
}
</code></pre>
<h2><a class="header" href="#database" id="database">Database</a></h2>
<p>Configure database settings:</p>
<pre><code class="language-bash">export WG_NEO4J_HOST=127.0.0.1
export WG_NEO4J_PORT=7687
export WG_NEO4J_USER=neo4j
export WG_NEO4J_PASS=*MY-DB-PASSWORD*
</code></pre>
<p>Start a 4.1 Neo4j database:</p>
<pre><code class="language-bash">docker run --rm -p 7687:7687 -e NEO4J_AUTH=&quot;${WG_NEO4J_USER}/${WG_NEO4J_PASS}&quot; neo4j:4.1
</code></pre>
<h2><a class="header" href="#run" id="run">Run</a></h2>
<pre><code class="language-bash">cargo run
</code></pre>
<h1><a class="header" href="#databases" id="databases">Databases</a></h1>
<p>Warppgrapher supports using either of two database back-ends for graph data:</p>
<ol>
<li>Azure Cosmos DB</li>
<li>Gremlin-based Databases (e.g. Apache Tinkerpop and AWS Neptune)</li>
<li>Neo4J</li>
</ol>
<p>Using each of the databases requires correctly selecting a crate feature and 
setting up appropriate environment variables to allow Warpgrapher to connect 
with the database.</p>
<h2><a class="header" href="#azure-cosmos-db" id="azure-cosmos-db">Azure Cosmos DB</a></h2>
<p>Add Warpgrapher to your project config:</p>
<p><code>cargo.toml</code></p>
<pre><code class="language-toml">[dependencies]
warpgrapher = { version = &quot;0.3.0&quot;, features = [&quot;cosmos&quot;] }
</code></pre>
<p>Then set up environment variables to contact your Cosmos DB:</p>
<pre><code class="language-bash">export WG_COSMOS_HOST=*MY-COSMOS-DB*.gremlin.cosmos.azure.com
export WG_COSMOS_PORT=443
export WG_COSMOS_USER=/dbs/*MY-COSMOS-DB*/colls/*MY-COSMOS-COLLECTION*
export WG_COSMOS_PASS=*MY-COSMOS-KEY*
</code></pre>
<p>Note that when setting up your Cosmos database, you must configure it to offer a Gremlin graph API.</p>
<p>Note also that you must set your partition key to be named <code>partitionKey</code>.</p>
<p>Be advised that Gremlin traversals are not executed atomically within Cosmos DB. A traversal may 
fail part way through if, for example, one reaches the read unit capacity limit.  See 
<a href="https://medium.com/@jayanta.mondal/cosmos-db-graph-gremlin-api-how-to-executing-multiple-writes-as-a-unit-via-a-single-gremlin-2ce82d8bf365">this article</a> 
for details. The workaround proposed in the article helps, but even idempotent queries do not 
guarantee atomicity.  Warpgrapher does not use idempotent queries with automated retries to overcome
this shortcoming of Cosmos DB, so note that if using Cosmos, there is a risk that a failed query 
could leave partially applied results behind.</p>
<h2><a class="header" href="#gremlin-based-database" id="gremlin-based-database">Gremlin-Based Database</a></h2>
<p>Add Warpgrapher to your project config:</p>
<p><code>cargo.toml</code></p>
<pre><code class="language-toml">[dependencies]
warpgrapher = { version = &quot;0.3.0&quot;, features = [&quot;gremlin&quot;] }
</code></pre>
<p>Then set up environment variables to contact your Gremlin-based DB:</p>
<pre><code class="language-bash">export WG_GREMLIN_HOST=localhost
export WG_GREMLIN_PORT=8182
export WG_GREMLIN_USER=stephen
export WG_GREMLIN_PASS=password
export WG_GREMLIN_CERT=true
export WG_GREMLIN_UUID=true
</code></pre>
<p>The <code>WG_GREMLIN_CERT</code> environment variable is true if Warpgrapher should ignore the validity of 
certificates. This may be necessary in a development or test environment, but should always be set
to false in production.</p>
<p>The <code>WG_GREMLIN_UUID</code> environment variable is set to true if Wargrapher is connecting to a back-end,
like Apache Tinkerpop, that uses a UUID type for the identifier of a node or vertex. If the back-end
uses a <code>String</code> type that contains a string representation of an identifier, such as Cosmos DB, then
set this evironment variable to <code>false</code>.</p>
<p>If you do not already have a Gremlin-based database running, you can run one using Docker:</p>
<pre><code class="language-bash">docker build -t gremlin -f tests/fixtures/gremlin/Dockerfile tests/fixtures/gremlin
docker run --rm -p 8182:8182 gremlin:latest
</code></pre>
<p>To use an interactive gremlin console to manually inspect test instances, run</p>
<pre><code class="language-bash">docker build -t gremlin-console -f tests/fixtures/gremlin-console/Dockerfile tests/fixtures/gremlin-console
docker run -i --net=host --rm gremlin-console:latest
</code></pre>
<p>In the console, connect to the remote graph:</p>
<pre><code>:remote connect tinkerpop.server conf/remote.yaml
:remote console
</code></pre>
<h2><a class="header" href="#neo4j" id="neo4j">Neo4J</a></h2>
<p>Add Warpgrapher to your project config:</p>
<pre><code class="language-toml">[dependencies]
warpgrapher = { version = &quot;0.3.0&quot;, features = [&quot;neo4j&quot;] }
</code></pre>
<p>Then set up environment variables to contact your Neo4J DB:</p>
<pre><code class="language-bash">export WG_NEO4J_HOST=127.0.0.1
export WG_NEO4J_PORT=7687
export WG_NEO4J_USER=neo4j
export WG_NEO4J_PASS=*MY-DB-PASSWORD*
</code></pre>
<p>If you do not already have a Neo4J database running, you can run one using Docker:</p>
<pre><code class="language-bash">docker run -e NEO4JAUTH=&quot;${WG_NEO4J_USER}:${WG_NEO4J_PASS}&quot; neo4j:4.1
</code></pre>
<h1><a class="header" href="#warpgrapher-config" id="warpgrapher-config">Warpgrapher Config</a></h1>
<p>In the <a href="warpgrapher/">Quickstart</a> we demonstrated how to initialize a <code>Config</code> from a configurationf file read from file at run time. A Warpgrapher <code>Config</code> can also be generated programatically. The resulting configs from all the examples below are equivalent. </p>
<h3><a class="header" href="#text-config" id="text-config">Text Config</a></h3>
<pre><code class="language-yaml">version: 1
model:

  # User
  - name: User
    props:
      - name: username
        type: String
      - name: email
        type: String

  # Team
  - name: Team
    props:
      - name: teamname
        type: String
    rels:
      - name: members
        nodes: [User]
        list: true
</code></pre>
<h3><a class="header" href="#programmatic-config" id="programmatic-config">Programmatic Config</a></h3>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use warpgrapher::engine::config::{Config, Property, Relationship, Type};

let config = Config::new(
    1,
    vec![
        // User
        Type::new(
            &quot;User&quot;.to_string(),
            vec![
                Property::new(
                    &quot;username&quot;.to_string(),
                    &quot;String&quot;.to_string(),
                    false,
                    false,
                    None,
                    None,
                ),
                Property::new(
                    &quot;email&quot;.to_string(),
                    &quot;String&quot;.to_string(),
                    false,
                    false,
                    None,
                    None,
                ),
            ],
            Vec::new(),
            EndpointsFilter::all(),
        ),
        // Team
        Type::new(
            &quot;Team&quot;.to_string(),
            vec![Property::new(
                &quot;teamname&quot;.to_string(),
                &quot;String&quot;.to_string(),
                false,
                false,
                None,
                None,
            )],
            vec![Relationship::new(
                &quot;members&quot;.to_string(),
                true,
                vec![&quot;User&quot;.to_string()],
                Vec::new(),
                EndpointsFilter::default(),
                None,
            )],
            EndpointsFilter::all(),
        ),
    ],
    vec![],
);
<span class="boring">}
</span></code></pre></pre>
<h1><a class="header" href="#warpgrapher-crud-api" id="warpgrapher-crud-api">Warpgrapher CRUD API</a></h1>
<p>One of the primary features of Warpgrapher is the auto-generation of CRUD operations for all Types. This includes basic and advanced queries that support nested operations and graph traversals. </p>
<p>Warpgrapher automatically creates a set of CRUD (Create, Read, Update, Delete) operations for each Type and each rel in a Type. This page describes the format of those automatically generated GraphQL operations. </p>
<p>For for more details on general GraphQL syntax, see: https://graphql.org/learn/.</p>
<h1><a class="header" href="#node-read" id="node-read">Node Read</a></h1>
<ul>
<li><a href="api/node_read.html#read-all-nodes">Read All Nodes</a></li>
<li><a href="api/node_read.html#read-nodes-with-matching-props">Read nodes with matching props</a></li>
<li><a href="api/node_read.html#return-nodes-with-relationships-to-other-nodes-with-matching-props">Return nodes with relationships to other nodes with matching props</a></li>
</ul>
<h3><a class="header" href="#return-all-nodes" id="return-all-nodes">Return all nodes</a></h3>
<p>To return all <code>Project</code> nodes:</p>
<pre><code>query {
    Project {
        id
        name
        status
    }
}
</code></pre>
<h3><a class="header" href="#return-nodes-with-matching-props" id="return-nodes-with-matching-props">Return nodes with matching props</a></h3>
<p>To return all <code>Project</code> nodes with <code>status == &quot;ACTIVE&quot;</code>:</p>
<pre><code>query {
    Project(
        input: {
            status: &quot;ACTIVE&quot;
        }
    )
    {
        id
        name
    }
}
</code></pre>
<h3><a class="header" href="#return-nodes-with-relationships-to-other-nodes-with-matching-props" id="return-nodes-with-relationships-to-other-nodes-with-matching-props">Return nodes with relationships to other nodes with matching props</a></h3>
<p>To returns all <code>Project</code> nodes containing an <code>owner</code> relationship to a <code>User</code> node with <code>name=&quot;Halsey&quot;</code>:</p>
<pre><code>query {
    Project(
        input: {
            owner: {
                dst: {
                    User: {
                        name: &quot;Halsey&quot;
                    }
                }
            }
        }
    )
    { ... }
}
</code></pre>
<h1><a class="header" href="#node-create" id="node-create">Node Create</a></h1>
<ul>
<li><a href="api/node_create.html#create-node-with-no-relationships">Create node with no relationships</a></li>
<li><a href="api/node_create.html#create-node-with-relationship-to-a-new-node">Create node with relationship to a NEW node</a></li>
<li><a href="api/node_create.html#create-node-with-relationship-to-an-existing-node">Create node with relationship to an EXISTING node</a></li>
</ul>
<h3><a class="header" href="#create-node-with-no-relationships" id="create-node-with-no-relationships">Create node with no relationships</a></h3>
<p>To create a new <code>Project</code> node by itself:</p>
<pre><code>mutation {
    ProjectCreate(
        input: {
            name: &quot;Project 1&quot;,
            status: &quot;ACTIVE&quot;
        }
    )
    {
        id
        name
    }
}
</code></pre>
<p>Output:</p>
<pre><code class="language-json">{
  &quot;data&quot;: {
    &quot;ProjectCreate&quot;: {
      &quot;id&quot;: &quot;a55e1dae-a87f-4ca1-8724-b967a678b942&quot;,
      &quot;name&quot;: &quot;Project 1&quot;
    }
  }
}
</code></pre>
<h3><a class="header" href="#create-node-with-relationship-to-a-new-node" id="create-node-with-relationship-to-a-new-node">Create node with relationship to a <code>NEW</code> node</a></h3>
<p>To create a new <code>Project</code> node with an <code>owner</code> relationship to a new <code>User</code> node:</p>
<pre><code>mutation {
    ProjectCreate(
        input: {
            name: &quot;Project 2&quot;,
            status: &quot;ACTIVE&quot;,
            owner: {
                dst: {
                    User: {
                        $NEW: {
                            name: &quot;Smith&quot;
                        }
                    }
                }
            }
        }
    )
    { ... }
}
</code></pre>
<h3><a class="header" href="#create-node-with-relationship-to-an-existing-node" id="create-node-with-relationship-to-an-existing-node">Create node with relationship to an <code>EXISTING</code> node</a></h3>
<p>To create a new <code>Project</code> node with an <code>owner</code> relationship to an existing <code>User</code> node:</p>
<pre><code>mutation {
    ProjectCreate(
        input: {
            name: &quot;Project 3&quot;,
            status: &quot;ACTIVE&quot;,
            owner: {
                dst: {
                    User: {
                        $EXISTING: {
                            name: &quot;Oneill&quot;
                        }
                    }
                }
            }
        }
    )
    { ... }
}
</code></pre>
<h1><a class="header" href="#node-update" id="node-update">Node Update</a></h1>
<ul>
<li><a href="api/node_update.html#update-props-on-node-with-matching-props">Update props on node with matching props</a></li>
<li><a href="api/node_update.html#update-props-on-node-with-a-relationship-to-a-node-containing-matching-props">Update props on node with a relationship to a node containing matching props</a></li>
<li><a href="api/node_update.html#update-node-to-add-multi-node-relationships">Update node to add (multi-node) relationships</a></li>
</ul>
<h3><a class="header" href="#update-props-on-node-with-matching-props" id="update-props-on-node-with-matching-props">Update props on node with matching props</a></h3>
<p>To update the <code>status</code> of the <code>Project</code> node with <code>name == &quot;Project 2&quot;</code>:</p>
<pre><code>mutation {
    ProjectCreate(
        input: {
            $MATCH: {
                name: &quot;Project 2&quot;
            },
            $SET: {
                status: &quot;INACTIVE&quot;
            }
        }
    )
    { ... }
}
</code></pre>
<h3><a class="header" href="#update-props-on-node-with-a-relationship-to-a-node-containing-matching-props" id="update-props-on-node-with-a-relationship-to-a-node-containing-matching-props">Update props on node with a relationship to a node containing matching props</a></h3>
<p>To update the status of any <code>Project</code> nodes containing an <code>owner</code> relationship to the <code>User</code> with <code>name  == &quot;Smith&quot;</code>:</p>
<pre><code>mutation {
    ProjectCreate(
        input: {
            $MATCH: {
                owner: {
                    dst: {
                        User: {
                            name: &quot;Smith&quot;
                        }
                    }
                }
            },
            $SET: {
                status: &quot;INACTIVE&quot;
            }
        }
    )
    { ... }
}
</code></pre>
<h3><a class="header" href="#update-node-to-add-multi-node-relationships" id="update-node-to-add-multi-node-relationships">Update node to add <code>(multi-node)</code> relationships</a></h3>
<p>To update a specific <code>Project</code> node to add several <code>issue</code> relationships to new <code>Feature</code> and <code>Bug</code> nodes, call <code>ProjectUpdate</code> with:</p>
<pre><code>mutation {
    ProjectUpdate(
        input: {
            $MATCH: {
                id: &quot;&lt;ID&gt;&quot;
            },
            $SET: {
                issues: [
                    {
                        $ADD: {
                            dst: {
                                Feature: {
                                    $NEW: {
                                        name: &quot;Add login page&quot;
                                    }
                                }
                            }
                        }
                    },
                    {
                        $ADD: {
                            dst: {
                                Bug: {
                                    $NEW: {
                                        name: &quot;Fix auth bug&quot;
                                    }
                                }
                            }
                        }
                    }
                ]
            }
        }
    ) 
    { ... }
}
</code></pre>
<h1><a class="header" href="#node-delete" id="node-delete">Node Delete</a></h1>
<ul>
<li><a href="api/node_delete.html#delete-node-with-matching-props">Delete node with matching props</a></li>
</ul>
<h3><a class="header" href="#delete-node-with-matching-props" id="delete-node-with-matching-props">Delete node with matching props</a></h3>
<p>To delete <code>Project</code> nodes with status &quot;INACTIVE&quot;, call <code>ProjectDelete</code> with: </p>
<pre><code>mutation {
    ProjectDelete(
        input: {
            $MATCH: {
                status: &quot;INACTIVE&quot;
            },
            $DELETE: {
            }
        }
    )
    { ... }
}
</code></pre>
<h1><a class="header" href="#relationship-read" id="relationship-read">Relationship Read</a></h1>
<ul>
<li><a href="api/rel_read.html#find-relationships-by-src-node">Find relationships by src node</a></li>
<li><a href="api/rel_read.html#find-relationships-by-dst-node">Find relationships by dst node</a></li>
<li><a href="api/rel_read.html#find-relationships-by-rel-props">Find relationships by rel props</a></li>
</ul>
<h3><a class="header" href="#find-relationships-by-src-node" id="find-relationships-by-src-node">Find relationships by src node</a></h3>
<pre><code>query {
    ProjectIssues(input: {
        src: {
            Project: {
                name: &quot;Project 0&quot;
            }
        }
    })
    {
        id
    }
}
</code></pre>
<h3><a class="header" href="#find-relationships-by-dst-node" id="find-relationships-by-dst-node">Find relationships by dst node</a></h3>
<pre><code>query {
    ProjectIssues(input: {
        dst: {
            Feature: {
                name: &quot;Add new button&quot;
            }
        }
    })
    {...}
}
</code></pre>
<h3><a class="header" href="#find-relationships-by-rel-props" id="find-relationships-by-rel-props">Find relationships by rel props</a></h3>
<pre><code>query {
    ProjectOwner(input: {
        props: {
            since: &quot;2015&quot;
        }
    })
    {...}
}
</code></pre>
<h1><a class="header" href="#relationship-create" id="relationship-create">Relationship Create</a></h1>
<ul>
<li><a href="api/rel_create.html#create-relationship-between-pair-of-existing-nodes">Create relationship between pair of existing nodes</a></li>
<li><a href="api/rel_create.html#create-relationship-from-existing-node-to-new-node">Create relationship from existing node to new node</a></li>
</ul>
<h3><a class="header" href="#create-relationship-between-pair-of-existing-nodes" id="create-relationship-between-pair-of-existing-nodes">Create relationship between pair of existing nodes</a></h3>
<pre><code>mutation {
    ProjectOwnerCreate(input: {
        $MATCH: {
            name: &quot;Project0&quot;
        },
        $CREATE: {
            dst: {
                User: {
                    $EXISTING: {
                        name: &quot;Jane&quot;
                    }
                }
            }
        } 
    })
    {...}
}
</code></pre>
<h3><a class="header" href="#create-relationship-between-from-existing-node-to-new-node" id="create-relationship-between-from-existing-node-to-new-node">Create relationship between from existing node to new node</a></h3>
<pre><code>mutation {
    ProjectOwnerCreate(input: {
        $MATCH: {
            name: &quot;Project0&quot;
        },
        $CREATE: {
            dst: {
                User: {
                    $NEW: {
                        name: &quot;Joe&quot;
                    }
                }
            }
        } 
    })
    {...}
}
</code></pre>
<h1><a class="header" href="#relationship-update" id="relationship-update">Relationship Update</a></h1>
<ul>
<li><a href="api/rel_update.html#update-relationship-props">Update relationship props</a></li>
</ul>
<h3><a class="header" href="#update-relationships-props" id="update-relationships-props">Update relationships props</a></h3>
<pre><code>mutation {
    ProjectOwnerUpdate(input: {
        $MATCH: {
            props: {
                sin
            }
        }
    })
    {
        id
    }
}
</code></pre>
<h1><a class="header" href="#relationship-delete" id="relationship-delete">Relationship Delete</a></h1>
<ul>
<li><a href="api/rel_delete.html#delete-relationships">Delete relationships</a></li>
</ul>
<h3><a class="header" href="#delete-relationships" id="delete-relationships">Delete relationships</a></h3>
<pre><code>mutation {
    ProjectOwnerDelete(input: {
        $MATCH: {
            src: {
                Project: {
                    name: &quot;Project0&quot;
                }
            }
        }
    })
}
</code></pre>
<p>Output:</p>
<pre><code class="language-json">{
    &quot;data&quot;: {
        &quot;ProjectOwnerDelete&quot;: 1
    }
}
</code></pre>
<h1><a class="header" href="#engine-features" id="engine-features">Engine Features</a></h1>
<h1><a class="header" href="#static-endpoints" id="static-endpoints">Static Endpoints</a></h1>
<p>Warpgrapher includes built-in static endpoints that provide useful information or functionality. Built-in static endpoints names are preceded by <code>_</code>.</p>
<h2><a class="header" href="#version" id="version">Version</a></h2>
<p>If the <code>Engine</code> is built with an explicit version:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let mut server: Engine&lt;(), ()&gt; = Engine::new(config, db)
    .with_version(&quot;0.1.0&quot;.to_string())
    .build();
<span class="boring">}
</span></code></pre></pre>
<p>the version value can be accessed via the <code>_version</code> endpoint:</p>
<pre><code>query {
    _version
}
</code></pre>
<pre><code class="language-json">{
  &quot;data&quot;: {
    &quot;_version&quot;: &quot;0.1.0&quot;
  }
}
</code></pre>
<p>If the server is not configured with an explicit version, the <code>_version</code> endpoint will return <code>null</code>:</p>
<pre><code class="language-json">{
  &quot;data&quot;: {
    &quot;_version&quot;: null
  }
}
</code></pre>
<h1><a class="header" href="#defined-endpoints" id="defined-endpoints">Defined Endpoints</a></h1>
<p>In addition to the CRUD endpoints auto-generated for each type, Warpgrapher provides the ability to define additional endpoints. </p>
<h2><a class="header" href="#usage" id="usage">Usage</a></h2>
<h4><a class="header" href="#1-add-endpoints-to-config" id="1-add-endpoints-to-config">1. Add Endpoints to Config</a></h4>
<p>The following config specified no types in the <code>model</code> section (so no CRUD endpoints will be generated), but defines several endpoints of varying inputs and outputs. </p>
<pre><code class="language-yaml">version: 1
model:

  # Team
  - name: Team
    props:
    - name: name
      type: String
    - name: size
      type: Int

endpoints:

  # GetAppName
  - name: GetAppName
    class: Query
    input: null
    output:
      type: String

  # GetLargetTeam
  - name: GetLargestTeam
    class: Query
    input: null
    output:
      type: Team
</code></pre>
<h4><a class="header" href="#2-implement-endpoint-resolver-logic" id="2-implement-endpoint-resolver-logic">2. Implement endpoint resolver logic</a></h4>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::collections::HashMap;
use warpgrapher::engine::resolvers::{ResolverFacade, ExecutionResult};
use warpgrapher::value::Value;

// resolver that returns a Scalar (String)
fn resolve_getappname(
  context: ResolverFacade&lt;(), ()&gt;
) -&gt; ExecutionResult {

  facade.resolve_scalar(&quot;MyAppName&quot;)
}

// resolver that returns a Node (Team)
fn resolve_getlargestteam(
  facade: ResolverFacade&lt;(), ()&gt;
) -&gt; ExecutionResult {

  // query database to get team ...
  let mut hm = HashMap::new();
  hm.insert(&quot;name&quot;.to_string(), Value::String(&quot;Blue Team&quot;.to_string()));
  hm.insert(&quot;size&quot;.to_string(), Value::Int64(5));
  
  let largest_team_node = facade.create_node((&quot;Team&quot;, &amp;hm);

  context.resolve_node(&amp;larget_team_node)
}
<span class="boring">}
</span></code></pre></pre>
<h4><a class="header" href="#3-add-resolvers-when-building-engine" id="3-add-resolvers-when-building-engine">3. Add resolvers when building <code>Engine</code></a></h4>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use warpgrapher::Engine;

let mut resolvers = Resolvers&lt;(), ()&gt;::new();
resolvers.insert(&quot;GetAppName&quot;.to_string, Box::new(resolve_getappname));
resolvers.insert(&quot;GetLargestTeam&quot;.to_string, Box::new(resolve_getlargestteam));

let engine = Engine&lt;(), ()&gt;::new(config, db)
    .with_resolvers(resolvers)
    .build();
<span class="boring">}
</span></code></pre></pre>
<h4><a class="header" href="#4-call-defined-endpoints" id="4-call-defined-endpoints">4. Call Defined Endpoints</a></h4>
<pre><code>query {
  GetAppName
}
</code></pre>
<pre><code class="language-json">{
  &quot;data&quot;: {
    &quot;GetAppName&quot;: &quot;MyAppName&quot;
  }
}
</code></pre>
<pre><code>query {
  GetLargestTeam {
    id
    name
    size
  }
}
</code></pre>
<pre><code class="language-json">{
  &quot;data&quot;: {
    &quot;GetLargestTeam&quot;: {
      &quot;id&quot;: &quot;123456789012345670&quot;,
      &quot;name&quot;: &quot;Blue Team&quot;,
      &quot;size&quot;: 5
    }
  }
}
</code></pre>
<h1><a class="header" href="#dynamic-props" id="dynamic-props">Dynamic Props</a></h1>
<p>When Warpgrapher auto-generates a CRUD endpoint, the values of Node and Relationship properties are retreived from the database and returned in a query. In some cases, however, it may be necessary to perform real-time computations to derive the value of a prop. We call these type of properties &quot;dynamic properties&quot;, and Warpgrapher provides a mechanism to execute custom logic to resolve the value of the prop. </p>
<h2><a class="header" href="#usage-1" id="usage-1">Usage</a></h2>
<h4><a class="header" href="#1-mark-a-properties-as-dynamic-by-setting-the-resolver-field" id="1-mark-a-properties-as-dynamic-by-setting-the-resolver-field">1. Mark a properties as dynamic by setting the resolver field</a></h4>
<pre><code class="language-rust no_run noplayground">
static CONFIG: &amp;str = &quot;
version: 1
model:
  - name: User
    props:
      - name: email
        type: String
endpoints:
  - name: EchoRequest
</code></pre>
<h4><a class="header" href="#2-define-custom-logic-that-resolve-the-prop-value" id="2-define-custom-logic-that-resolve-the-prop-value">2. Define custom logic that resolve the prop value</a></h4>
<pre><code class="language-rust no_run noplayground">    input: null
    output: 
      type: String
&quot;;

#[derive(Clone, Debug)]
struct AppRequestContext {
    request_id: String,
}
</code></pre>
<h4><a class="header" href="#3-add-prop-resolver-when-building-engine" id="3-add-prop-resolver-when-building-engine">3. Add prop resolver when building <code>Engine</code></a></h4>
<pre><code class="language-rust no_run noplayground">}

fn main() {
    // parse warpgrapher config
    let config = Configuration::try_from(CONFIG.to_string()).expect(&quot;Failed to parse CONFIG&quot;);

    // define database endpoint
    let db = Runtime::new()
        .expect(&quot;Expected tokio runtime.&quot;)
</code></pre>
<h1><a class="header" href="#dynamic-relationships" id="dynamic-relationships">Dynamic Relationships</a></h1>
<p>Dynamic relationships are similiar to Dynamic Props. Instead of returning values contained in the database, Dynamic relationships allows values to be computed at request time. </p>
<h2><a class="header" href="#usage-2" id="usage-2">Usage</a></h2>
<h4><a class="header" href="#1-mark-rel-as-dynamic-by-setting-the-resolver-field" id="1-mark-rel-as-dynamic-by-setting-the-resolver-field">1. Mark rel as dynamic by setting the resolver field</a></h4>
<pre><code class="language-rust no_run noplayground">version: 1
model:
  - name: User
    props:
      - name: email
        type: String
endpoints:
  - name: EchoRequest
    class: Query
    input: null
    output: 
      type: String
&quot;;

#[derive(Clone, Debug)]
struct AppRequestContext {
</code></pre>
<h4><a class="header" href="#2-define-custom-logic-that-resolve-the-prop-value-1" id="2-define-custom-logic-that-resolve-the-prop-value-1">2. Define custom logic that resolve the prop value</a></h4>
<pre><code class="language-rust no_run noplayground">}

impl RequestContext for AppRequestContext {
    fn new() -&gt; AppRequestContext {
        // generate random request id
        let request_id = &quot;1234&quot;.to_string();
        AppRequestContext { request_id }
    }
}

fn resolve_echo_request(facade: ResolverFacade&lt;(), AppRequestContext&gt;) -&gt; ExecutionResult {
    let request_context = facade.request_context().unwrap();
    let request_id = request_context.request_id.clone();
    facade.resolve_scalar(format!(&quot;echo! (request_id: {})&quot;, request_id))
}

fn main() {
    // parse warpgrapher config
    let config = Configuration::try_from(CONFIG.to_string()).expect(&quot;Failed to parse CONFIG&quot;);
</code></pre>
<h1><a class="header" href="#global-context" id="global-context">Global Context</a></h1>
<p>The GlobalContext feature enable the creation of <strong>global state that is accessible across different event hook points</strong>, including inside function resolvers.</p>
<p>The example below will demonstrate how to set a <code>tenant_id</code> variable in the global context that can be accessed within a function resolver and returned to the caller. </p>
<h3><a class="header" href="#usage-3" id="usage-3">Usage</a></h3>
<h4><a class="header" href="#1-define-globalcontext-struct" id="1-define-globalcontext-struct">1. Define GlobalContext struct</a></h4>
<p>Define a struct containing all the owned variables of the global state. The struct must implement <code>Clone</code>, <code>Debug</code>, <code>Sync</code>, <code>Send</code> and warpgrapher <code>GlobalContext</code>. </p>
<pre><code class="language-rust no_run noplayground">
#[derive(Clone, Debug)]
struct AppGlobalContext {
    tenant_id: String,
}

</code></pre>
<h4><a class="header" href="#2-create-globalcontext-instance" id="2-create-globalcontext-instance">2. Create GlobalContext instance</a></h4>
<p>Create an instance of the global context struct with initial values. </p>
<pre><code class="language-rust no_run noplayground">        .expect(&quot;Failed to create neo4j database pool&quot;);
    // define global context
    let global_ctx = AppGlobalContext {
</code></pre>
<h4><a class="header" href="#3-create-an-engine-with-global-context" id="3-create-an-engine-with-global-context">3. Create an <code>Engine</code> with global context</a></h4>
<p>The global context is passed to the engine via the builder pattern as an argument to the <code>.with_global_ctx()</code> method. The type of the global context must also be specified as the first type parameter of <code>Engine</code>. </p>
<pre><code class="language-rust no_run noplayground">
    // create warpgrapher engine
    let engine: Engine&lt;AppGlobalContext, ()&gt; = Engine::new(config, db)
        .with_global_ctx(global_ctx)
        .with_resolvers(resolvers)
</code></pre>
<h4><a class="header" href="#4-use-globalcontext-in-a-resolver" id="4-use-globalcontext-in-a-resolver">4. Use GlobalContext in a resolver</a></h4>
<p>The global context is now accessible in function resolvers.</p>
<pre><code class="language-rust no_run noplayground">
fn resolve_get_tenant(facade: ResolverFacade&lt;AppGlobalContext, ()&gt;) -&gt; ExecutionResult {
    let global_context = match facade.global_context() {
        Some(v) =&gt; v,
        None =&gt; {
            return facade.resolve_null();
        }
    };
    let tenant_id = global_context.tenant_id.clone();
    facade.resolve_scalar(tenant_id)
</code></pre>
<h3><a class="header" href="#full-example" id="full-example">Full Example</a></h3>
<p>View on <a href="https://github.com/warpforge/warpgrapher/blob/v0.3.0/examples/global_context/main.rs">Github</a>.</p>
<h1><a class="header" href="#request-context" id="request-context">Request Context</a></h1>
<p>The Request Context feature enables the creation of <strong>mutable state through the lifecycle of a request</strong>.</p>
<h3><a class="header" href="#usage-4" id="usage-4">Usage</a></h3>
<h4><a class="header" href="#1-define-requestcontext-struct" id="1-define-requestcontext-struct">1. Define RequestContext struct</a></h4>
<p>Define a struct that contains mutable information to be available for the lifetime of a request. The request context must implement <code>Clone</code>, <code>Debug</code>, <code>Sync</code>, <code>Send</code>, and Warpgrapher <code>RequestContext</code>. </p>
<pre><code class="language-rust no_run noplayground">struct AppRequestContext {
    request_id: String,
}

impl RequestContext for AppRequestContext {
    fn new() -&gt; AppRequestContext {
        // generate random request id
        let request_id = &quot;1234&quot;.to_string();
        AppRequestContext { request_id }
    }
}

fn resolve_echo_request(facade: ResolverFacade&lt;(), AppRequestContext&gt;) -&gt; ExecutionResult {
    let request_context = facade.request_context().unwrap();
</code></pre>
<h4><a class="header" href="#2-create-engine-with-requestcontext-type-parameter" id="2-create-engine-with-requestcontext-type-parameter">2. Create Engine with RequestContext type parameter</a></h4>
<p>The RequestContext is specified in the second type paramter of <code>Engine</code>. </p>
<pre><code class="language-rust no_run noplayground">        .with_resolvers(resolvers)
        .build()
        .expect(&quot;Failed to build engine&quot;);

</code></pre>
<h4><a class="header" href="#3-access-context-inside-resolver" id="3-access-context-inside-resolver">3. Access Context inside resolver</a></h4>
<pre><code class="language-rust no_run noplayground">    facade.resolve_scalar(format!(&quot;echo! (request_id: {})&quot;, request_id))
}

fn main() {
    // parse warpgrapher config
</code></pre>
<h3><a class="header" href="#full-example-1" id="full-example-1">Full Example</a></h3>
<p>View on <a href="https://github.com/warpforge/warpgrapher/blob/v0.3.0/examples/request_context/main.rs">Github</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
